cat > public/pages/p2p-marketplace.html << 'P2P_IMPROVED_END'
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🤝 P2P Marketplace - Inter-Exchanger Trading</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="../css/style.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
    
    <!-- Header -->
    <header class="bg-gradient-to-r from-purple-600 to-pink-600 text-white shadow-lg">
        <div class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <i class="fas fa-handshake text-3xl"></i>
                    <div>
                        <h1 class="text-2xl font-bold">P2P Exchanger Marketplace</h1>
                        <p class="text-purple-200 text-sm">Inter-Exchanger Trading Network - Shopify for Exchangers</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="bg-purple-700 px-3 py-1 rounded-full text-sm">
                        <i class="fas fa-store text-xs mr-1"></i><span id="activeExchangers">2,847 Exchangers Online</span>
                    </div>
                    <a href="dashboard.html" class="bg-purple-700 px-4 py-2 rounded hover:bg-purple-800">
                        <i class="fas fa-arrow-left"></i> Dashboard
                    </a>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-6 py-8">
        
        <!-- Marketplace Overview -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-green-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">Active Orders</p>
                        <h3 class="text-2xl font-bold text-gray-800">1,247</h3>
                        <p class="text-green-600 text-sm">↗ 89 new today</p>
                    </div>
                    <div class="bg-green-100 p-3 rounded-full">
                        <i class="fas fa-shopping-cart text-green-600 text-2xl"></i>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-blue-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">24h Volume</p>
                        <h3 class="text-2xl font-bold text-gray-800">$18.4M</h3>
                        <p class="text-blue-600 text-sm">Inter-exchanger trades</p>
                    </div>
                    <div class="bg-blue-100 p-3 rounded-full">
                        <i class="fas fa-chart-line text-blue-600 text-2xl"></i>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-purple-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">My Success Rate</p>
                        <h3 class="text-2xl font-bold text-gray-800">98.7%</h3>
                        <p class="text-purple-600 text-sm">127 completed trades</p>
                    </div>
                    <div class="bg-purple-100 p-3 rounded-full">
                        <i class="fas fa-medal text-purple-600 text-2xl"></i>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-orange-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">Avg Response Time</p>
                        <h3 class="text-2xl font-bold text-gray-800">2.1 min</h3>
                        <p class="text-orange-600 text-sm">Fast settlement</p>
                    </div>
                    <div class="bg-orange-100 p-3 rounded-full">
                        <i class="fas fa-clock text-orange-600 text-2xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Trading Interface -->
        <div class="grid grid-cols-1 xl:grid-cols-4 gap-8 mb-8">
            
            <!-- Create Order Form -->
            <div class="xl:col-span-3 bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold mb-6">📝 Create Trading Order</h2>
                
                <form id="p2pOrderForm" class="space-y-6">
                    <!-- Order Type Selection -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">I Want To:</label>
                        <div class="grid grid-cols-2 gap-4">
                            <label class="cursor-pointer">
                                <input type="radio" name="orderType" value="buy" class="sr-only" checked>
                                <div id="buyOption" class="border-2 border-green-200 bg-green-50 rounded-lg p-4 text-center hover:border-green-500 transition-colors">
                                    <i class="fas fa-shopping-cart text-2xl text-green-600 mb-2"></i>
                                    <div class="font-semibold text-green-800">BUY Currency</div>
                                    <div class="text-sm text-green-600">I need currency from other exchangers</div>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="orderType" value="sell" class="sr-only">
                                <div id="sellOption" class="border-2 border-blue-200 rounded-lg p-4 text-center hover:border-blue-500 transition-colors">
                                    <i class="fas fa-hand-holding-usd text-2xl text-blue-600 mb-2"></i>
                                    <div class="font-semibold text-blue-800">SELL Currency</div>
                                    <div class="text-sm text-blue-600">I have currency to offer other exchangers</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Currency Pair -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="border rounded-lg p-4">
                            <h4 class="font-semibold text-gray-800 mb-3">💰 I Have / Offering</h4>
                            <div class="space-y-3">
                                <select id="fromCurrency" class="w-full p-3 border rounded-lg">
                                    <option value="AED">🇦🇪 AED - UAE Dirham</option>
                                    <option value="USD">🇺🇸 USD - US Dollar</option>
                                    <option value="SAR">🇸🇦 SAR - Saudi Riyal</option>
                                    <option value="EUR">🇪🇺 EUR - Euro</option>
                                    <option value="GBP">🇬🇧 GBP - British Pound</option>
                                    <option value="IRT">🇮🇷 IRT - Iranian Toman</option>
                                    <option value="INR">🇮🇳 INR - Indian Rupee</option>
                                    <option value="PKR">🇵🇰 PKR - Pakistani Rupee</option>
                                    <option value="BDT">🇧🇩 BDT - Bangladeshi Taka</option>
                                    <option value="EGP">🇪🇬 EGP - Egyptian Pound</option>
                                </select>
                                <input type="number" id="fromAmount" placeholder="Amount I have" class="w-full p-3 border rounded-lg">
                            </div>
                        </div>

                        <div class="border rounded-lg p-4">
                            <h4 class="font-semibold text-gray-800 mb-3">🎯 I Want / Looking For</h4>
                            <div class="space-y-3">
                                <select id="toCurrency" class="w-full p-3 border rounded-lg">
                                    <option value="USD">🇺🇸 USD - US Dollar</option>
                                    <option value="AED">🇦🇪 AED - UAE Dirham</option>
                                    <option value="SAR">🇸🇦 SAR - Saudi Riyal</option>
                                    <option value="EUR">🇪🇺 EUR - Euro</option>
                                    <option value="GBP">🇬🇧 GBP - British Pound</option>
                                    <option value="IRT">🇮🇷 IRT - Iranian Toman</option>
                                    <option value="INR">🇮🇳 INR - Indian Rupee</option>
                                    <option value="PKR">🇵🇰 PKR - Pakistani Rupee</option>
                                    <option value="BDT">🇧🇩 BDT - Bangladeshi Taka</option>
                                    <option value="EGP">🇪🇬 EGP - Egyptian Pound</option>
                                </select>
                                <input type="number" id="toAmount" placeholder="Amount I want" class="w-full p-3 border rounded-lg bg-gray-50" readonly>
                            </div>
                        </div>
                    </div>

                    <!-- Exchange Rate & Pricing -->
                    <div class="border rounded-lg p-4 bg-yellow-50">
                        <h4 class="font-semibold text-gray-800 mb-4">💱 Rate & Pricing Settings</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">My Exchange Rate</label>
                                <input type="number" id="exchangeRate" placeholder="3.6725" step="0.0001" class="w-full p-3 border rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Rate Type</label>
                                <select id="rateType" class="w-full p-3 border rounded-lg">
                                    <option value="fixed">Fixed Rate</option>
                                    <option value="market_plus">Market + Margin</option>
                                    <option value="negotiable">Negotiable</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Profit Margin %</label>
                                <input type="number" id="profitMargin" placeholder="0.5" step="0.1" class="w-full p-3 border rounded-lg">
                            </div>
                        </div>
                        
                        <!-- Market Rate Reference -->
                        <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                            <div class="text-sm">
                                <span class="text-blue-700">📈 Current Market Rate:</span>
                                <span class="font-semibold text-blue-800" id="marketRate">1 AED = 0.2724 USD</span>
                                <span class="text-blue-600 ml-4">📊 Last Updated: 2 min ago</span>
                            </div>
                        </div>
                    </div>

                    <!-- Trading Preferences -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Order Limits -->
                        <div class="border rounded-lg p-4">
                            <h4 class="font-semibold text-gray-800 mb-4">📏 Order Limits</h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm text-gray-600 mb-1">Minimum Order</label>
                                    <input type="number" id="minOrder" placeholder="1,000" class="w-full p-2 border rounded">
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-600 mb-1">Maximum Order</label>
                                    <input type="number" id="maxOrder" placeholder="50,000" class="w-full p-2 border rounded">
                                </div>
                            </div>
                        </div>

                        <!-- Settlement Methods -->
                        <div class="border rounded-lg p-4">
                            <h4 class="font-semibold text-gray-800 mb-4">🏦 Settlement Methods</h4>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2" checked> 
                                    <span class="text-sm">Bank Transfer</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2"> 
                                    <span class="text-sm">Cash Exchange</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2"> 
                                    <span class="text-sm">Cryptocurrency</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2"> 
                                    <span class="text-sm">Hawala Network</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Privacy & Visibility Settings -->
                    <div class="border rounded-lg p-4 bg-indigo-50">
                        <h4 class="font-semibold text-gray-800 mb-4">🔒 Privacy & Visibility Settings</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h5 class="font-medium text-gray-700 mb-3">Order Visibility:</h5>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="radio" name="visibility" value="public" class="mr-2" checked> 
                                        <span class="text-sm">Public - All exchangers can see</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="visibility" value="verified" class="mr-2"> 
                                        <span class="text-sm">Verified Only - KYC verified exchangers</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="visibility" value="premium" class="mr-2"> 
                                        <span class="text-sm">Premium Only - Premium subscribers</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="visibility" value="private" class="mr-2"> 
                                        <span class="text-sm">Private - Invite only</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <h5 class="font-medium text-gray-700 mb-3">Information Display:</h5>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" id="showExactTime" class="mr-2"> 
                                        <span class="text-sm">Show exact posting time</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="showLocation" class="mr-2" checked> 
                                        <span class="text-sm">Show my city/country</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="showBusinessName" class="mr-2"> 
                                        <span class="text-sm">Show business name</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="showRating" class="mr-2" checked> 
                                        <span class="text-sm">Show my rating & reviews</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Order Duration -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Order Duration</label>
                            <select id="orderDuration" class="w-full p-3 border rounded-lg">
                                <option value="1h">1 Hour</option>
                                <option value="6h">6 Hours</option>
                                <option value="24h" selected>24 Hours</option>
                                <option value="3d">3 Days</option>
                                <option value="7d">7 Days</option>
                                <option value="30d">30 Days</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Auto-Refresh</label>
                            <select id="autoRefresh" class="w-full p-3 border rounded-lg">
                                <option value="never">Never</option>
                                <option value="hourly">Every Hour</option>
                                <option value="daily" selected>Daily</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Priority Level</label>
                            <select id="priorityLevel" class="w-full p-3 border rounded-lg">
                                <option value="normal">Normal</option>
                                <option value="urgent">Urgent (+fee)</option>
                                <option value="featured">Featured (+fee)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Additional Notes -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Additional Notes (Optional)</label>
                        <textarea id="orderNotes" rows="3" placeholder="Special requirements, preferred locations, timing constraints..." 
                                  class="w-full p-3 border rounded-lg"></textarea>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex space-x-4">
                        <button type="submit" class="flex-1 bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 font-semibold">
                            <i class="fas fa-plus mr-2"></i>Create P2P Order
                        </button>
                        <button type="button" onclick="saveAsDraft()" class="bg-gray-400 text-white px-6 py-3 rounded-lg hover:bg-gray-500">
                            <i class="fas fa-save mr-2"></i>Save Draft
                        </button>
                        <button type="button" onclick="previewOrder()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700">
                            <i class="fas fa-eye mr-2"></i>Preview
                        </button>
                    </div>
                </form>
            </div>

            <!-- Quick Actions & Search -->
            <div class="space-y-6">
                <!-- Search Orders -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-lg font-bold mb-4">🔍 Find Orders</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <input type="text" id="searchOrders" placeholder="Currency, amount, location..." class="w-full p-3 border rounded-lg">
                        </div>
                        
                        <div>
                            <select id="currencyFilter" class="w-full p-2 border rounded">
                                <option value="">All Currencies</option>
                                <option value="USD-AED">USD → AED</option>
                                <option value="AED-IRT">AED → IRT</option>
                                <option value="SAR-AED">SAR → AED</option>
                                <option value="EUR-USD">EUR → USD</option>
                            </select>
                        </div>
                        
                        <div>
                            <select id="amountFilter" class="w-full p-2 border rounded">
                                <option value="">Any Amount</option>
                                <option value="1000-10000">$1K - $10K</option>
                                <option value="10000-50000">$10K - $50K</option>
                                <option value="50000+">$50K+</option>
                            </select>
                        </div>
                        
                        <button onclick="searchP2POrders()" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
                            <i class="fas fa-search mr-1"></i>Search
                        </button>
                    </div>
                </div>

                <!-- Popular Pairs -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-lg font-bold mb-4">🔥 Trending Now</h3>
                    
                    <div class="space-y-3">
                        <button onclick="quickSearch('USD', 'AED')" class="w-full text-left p-3 bg-gray-50 rounded hover:bg-gray-100 transition-colors">
                            <div class="flex justify-between items-center">
                                <div>
                                    <div class="font-medium">USD → AED</div>
                                    <div class="text-sm text-gray-600">47 orders</div>
                                </div>
                                <div class="text-green-600 text-sm">+12%</div>
                            </div>
                        </button>

                        <button onclick="quickSearch('AED', 'IRT')" class="w-full text-left p-3 bg-gray-50 rounded hover:bg-gray-100 transition-colors">
                            <div class="flex justify-between items-center">
                                <div>
                                    <div class="font-medium">AED → IRT</div>
                                    <div class="text-sm text-gray-600">89 orders</div>
                                </div>
                                <div class="text-green-600 text-sm">+25%</div>
                            </div>
                        </button>

                        <button onclick="quickSearch('SAR', 'AED')" class="w-full text-left p-3 bg-gray-50 rounded hover:bg-gray-100 transition-colors">
                            <div class="flex justify-between items-center">
                                <div>
                                    <div class="font-medium">SAR → AED</div>
                                    <div class="text-sm text-gray-600">23 orders</div>
                                </div>
                                <div class="text-red-600 text-sm">-3%</div>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- My P2P Stats -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-lg font-bold mb-4">📊 My P2P Stats</h3>
                    
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Active Orders:</span>
                            <span class="font-semibold text-blue-600">5</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Completed Today:</span>
                            <span class="font-semibold text-green-600">12</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Total Volume:</span>
                            <span class="font-semibold">$284K</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Success Rate:</span>
                            <span class="font-semibold text-green-600">98.7%</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Rating:</span>
                            <div class="flex items-center">
                                <span class="text-yellow-400">★★★★★</span>
                                <span class="ml-1 text-sm text-gray-600">(4.9)</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Chat Access -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-lg font-bold mb-4">💬 Quick Chat</h3>
                    
                    <div class="space-y-3">
                        <div class="flex items-center space-x-3 p-2 hover:bg-gray-50 rounded">
                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                            <div class="flex-1">
                                <div class="font-medium text-sm">Dubai Gold Exchange</div>
                                <div class="text-xs text-gray-600">Online now</div>
                            </div>
                            <button onclick="openChat('dubai_gold')" class="text-blue-600 hover:text-blue-800">
                                <i class="fas fa-comment"></i>
                            </button>
                        </div>
                        
                        <div class="flex items-center space-x-3 p-2 hover:bg-gray-50 rounded">
                            <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                            <div class="flex-1">
                                <div class="font-medium text-sm">Tehran Exchange Co</div>
                                <div class="text-xs text-gray-600">5 min ago</div>
                            </div>
                            <button onclick="openChat('tehran_exchange')" class="text-blue-600 hover:text-blue-800">
                                <i class="fas fa-comment"></i>
                            </button>
                        </div>
                        
                        <div class="flex items-center space-x-3 p-2 hover:bg-gray-50 rounded">
                            <div class="w-3 h-3 bg-gray-400 rounded-full"></div>
                            <div class="flex-1">
                                <div class="font-medium text-sm">Riyadh Money Services</div>
                                <div class="text-xs text-gray-600">2 hours ago</div>
                            </div>
                            <button onclick="openChat('riyadh_money')" class="text-blue-600 hover:text-blue-800">
                                <i class="fas fa-comment"></i>
                            </button>
                        </div>
                    </div>
                    
                    <button onclick="openChatList()" class="w-full mt-4 bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
                        <i class="fas fa-comments mr-2"></i>All Chats
                    </button>
                </div>
            </div>
        </div>

        <!-- Active P2P Orders Table -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold">🛒 Available P2P Orders</h2>
                <div class="flex space-x-4">
                    <select id="orderTypeFilter" class="p-2 border rounded">
                        <option value="all">All Types</option>
                        <option value="buy">Buy Orders</option>
                        <option value="sell">Sell Orders</option>
                    </select>
                    <select id="statusFilter" class="p-2 border rounded">
                        <option value="active">Active Only</option>
                        <option value="new">New Today</option>
                        <option value="urgent">Urgent</option>
                    </select>
                    <button onclick="refreshP2POrders()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="min-w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Exchanger</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Type</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Currency Pair</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Amount</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Rate</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Location</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Time</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="p2pOrdersTable">
                        <!-- Orders populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- My Orders Section -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold">📋 My P2P Orders</h2>
                <div class="flex space-x-4">
                    <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">
                        5 Active
                    </span>
                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">
                        12 Completed Today
                    </span>
                    <button onclick="viewAllMyOrders()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
                        <i class="fas fa-list"></i> View All
                    </button>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="myOrdersGrid">
                <!-- My orders populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Chat Modal -->
    <div id="chatModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-lg max-w-2xl w-full max-h-90vh">
                <div class="p-4 border-b flex justify-between items-center">
                    <h3 class="text-lg font-bold" id="chatTitle">Chat with Exchanger</h3>
                    <button onclick="closeChatModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="p-4 h-96 overflow-y-auto" id="chatMessages">
                    <!-- Chat messages -->
                </div>
                <div class="p-4 border-t">
                    <div class="flex space-x-2">
                        <input type="text" id="chatInput" placeholder="Type your message..." class="flex-1 p-2 border rounded">
                        <button onclick="sendMessage()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../js/language.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/demo-controls.js"></script>
    <script>
        // P2P Orders data
        let p2pOrders = [
            {
                id: 1,
                exchanger: "Dubai Gold Exchange",
                country: "AE",
                city: "Dubai",
                type: "sell",
                fromCurrency: "AED",
                toCurrency: "USD", 
                amount: 100000,
                rate: 0.2724,
                minOrder: 1000,
                maxOrder: 50000,
                timePosted: "2h ago",
                showExactTime: false,
                showLocation: true,
                showBusinessName: true,
                rating: 4.9,
                trades: 847,
                responseTime: "1.2 min",
                online: true,
                settlement: ["bank", "cash"]
            },
            {
                id: 2,
                exchanger: "Tehran Exchange Co",
                country: "IR", 
                city: "Tehran",
                type: "buy",
                fromCurrency: "USD",
                toCurrency: "IRT",
                amount: 50000,
                rate: 42500,
                minOrder: 500,
                maxOrder: 10000,
                timePosted: "5h ago",
                showExactTime: false,
                showLocation: true,
                showBusinessName: false,
                rating: 4.7,
                trades: 234,
                responseTime: "2.1 min",
                online: true,
                settlement: ["bank", "crypto"]
            },
            {
                id: 3,
                exchanger: "****** Exchange",
                country: "SA",
                city: "Riyadh", 
                type: "sell",
                fromCurrency: "SAR",
                toCurrency: "AED",
                amount: 200000,
                rate: 1.0211,
                minOrder: 2000,
                maxOrder: 100000,
                timePosted: "Recently",
                showExactTime: false,
                showLocation: true,
                showBusinessName: false,
                rating: 4.8,
                trades: 567,
                responseTime: "1.8 min",
                online: false,
                settlement: ["bank"]
            }
        ];

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadP2POrders();
            loadMyOrders();
            updateMarketRate();
        });

        function loadP2POrders() {
            const tbody = document.getElementById('p2pOrdersTable');
            if (!tbody) return;

            tbody.innerHTML = p2pOrders.map(order => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            <div class="w-3 h-3 ${order.online ? 'bg-green-500' : 'bg-gray-400'} rounded-full mr-3"></div>
                            <div>
                                <div class="font-medium">${order.showBusinessName ? order.exchanger : '****** Exchange'}</div>
                                <div class="text-sm text-gray-600">
                                    ${order.showLocation ? `${order.city}, ${order.country}` : 'Location Hidden'}
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 text-xs rounded-full ${
                            order.type === 'buy' ? 'bg-blue-100 text-blue-800' : 'bg-green-100 text-green-800'
                        }">
                            ${order.type.toUpperCase()}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <div class="font-medium">${order.fromCurrency} → ${order.toCurrency}</div>
                        <div class="text-sm text-gray-600">${order.fromCurrency}/${order.toCurrency}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="font-medium">${order.amount.toLocaleString()} ${order.fromCurrency}</div>
                        <div class="text-sm text-gray-600">Min: ${order.minOrder.toLocaleString()}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="font-mono font-medium">${order.rate}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm">${order.showLocation ? `${order.city}` : 'Hidden'}</div>
                        <div class="text-xs text-gray-600">${order.country}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm">${order.showExactTime ? order.timePosted : 'Recently'}</div>
                        <div class="text-xs text-gray-600">Resp: ${order.responseTime}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex space-x-2">
                            <button onclick="contactExchanger(${order.id})" class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">
                                <i class="fas fa-comment mr-1"></i>Chat
                            </button>
                            <button onclick="makeOffer(${order.id})" class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
                                <i class="fas fa-handshake mr-1"></i>Offer
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function loadMyOrders() {
            // Sample my orders
            const myOrders = [
                {
                    id: 1,
                    type: 'sell',
                    pair: 'AED → USD',
                    amount: '50,000 AED',
                    rate: '0.2724',
                    status: 'Active',
                    responses: 3
                },
                {
                    id: 2,
                    type: 'buy', 
                    pair: 'USD → IRT',
                    amount: '10,000 USD',
                    rate: '42,500',
                    status: 'Active',
                    responses: 7
                }
            ];

            const grid = document.getElementById('myOrdersGrid');
            if (!grid) return;

            grid.innerHTML = myOrders.map(order => `
                <div class="border-2 ${order.type === 'sell' ? 'border-green-200 bg-green-50' : 'border-blue-200 bg-blue-50'} rounded-lg p-4">
                    <div class="flex justify-between items-start mb-3">
                        <span class="px-2 py-1 text-xs rounded-full ${
                            order.type === 'sell' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'
                        }">
                            ${order.type.toUpperCase()}
                        </span>
                        <span class="text-green-600 text-sm font-semibold">${order.status}</span>
                    </div>
                    <div class="mb-3">
                        <div class="font-bold text-lg">${order.pair}</div>
                        <div class="text-sm text-gray-600">${order.amount}</div>
                        <div class="text-sm">Rate: <span class="font-mono">${order.rate}</span></div>
                    </div>
                    <div class="mb-4">
                        <div class="text-sm text-gray-600">
                            <i class="fas fa-comments mr-1"></i>${order.responses} responses
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="editMyOrder(${order.id})" class="flex-1 bg-blue-600 text-white py-2 rounded text-sm hover:bg-blue-700">
                            Edit
                        </button>
                        <button onclick="viewResponses(${order.id})" class="flex-1 bg-purple-600 text-white py-2 rounded text-sm hover:bg-purple-700">
                            View Offers
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Chat functions
        function openChat(exchangerId) {
            document.getElementById('chatModal').classList.remove('hidden');
            document.getElementById('chatTitle').textContent = `Chat with Exchanger`;
            
            // Load chat messages
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = `
                <div class="space-y-4">
                    <div class="flex">
                        <div class="bg-gray-100 rounded-lg p-3 max-w-xs">
                            <p class="text-sm">Hello! I'm interested in your USD/AED order.</p>
                            <p class="text-xs text-gray-500 mt-1">2:30 PM</p>
                        </div>
                    </div>
                    <div class="flex justify-end">
                        <div class="bg-blue-500 text-white rounded-lg p-3 max-w-xs">
                            <p class="text-sm">Great! What amount are you looking for?</p>
                            <p class="text-xs text-blue-200 mt-1">2:32 PM</p>
                        </div>
                    </div>
                    <div class="flex">
                        <div class="bg-gray-100 rounded-lg p-3 max-w-xs">
                            <p class="text-sm">Around $25,000. Can we negotiate the rate?</p>
                            <p class="text-xs text-gray-500 mt-1">2:35 PM</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function closeChatModal() {
            document.getElementById('chatModal').classList.add('hidden');
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message) {
                const chatMessages = document.getElementById('chatMessages');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'flex justify-end';
                messageDiv.innerHTML = `
                    <div class="bg-blue-500 text-white rounded-lg p-3 max-w-xs">
                        <p class="text-sm">${message}</p>
                        <p class="text-xs text-blue-200 mt-1">Just now</p>
                    </div>
                `;
                chatMessages.appendChild(messageDiv);
                input.value = '';
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }

        function contactExchanger(orderId) {
            openChat(`order_${orderId}`);
        }

        function makeOffer(orderId) {
            showNotification('Offer system will open in a new modal', 'info');
        }

        function updateMarketRate() {
            // Update market rate display
            const marketRate = document.getElementById('marketRate');
            if (marketRate) {
                marketRate.textContent = '1 AED = 0.2724 USD';
            }
        }

        // Form functions
        function saveAsDraft() {
            showNotification('Order saved as draft', 'success');
        }

        function previewOrder() {
            showNotification('Order preview will open in modal', 'info');
        }

        function editMyOrder(orderId) {
            showNotification(`Editing order ${orderId}`, 'info');
        }

        function viewResponses(orderId) {
            showNotification(`Viewing ${orderId} responses`, 'info');
        }
    </script>
</body>
</html>
P2P_IMPROVED_EN