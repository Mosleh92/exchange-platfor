
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="hawalaTransfer">🏦 Hawala Transfer System - Underground Money Transfer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="../css/style.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
    
    <!-- Header -->
    <header class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-lg">
        <div class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <i class="fas fa-exchange-alt text-3xl"></i>
                    <div>
                        <h1 class="text-2xl font-bold" data-i18n="hawalaTransfer">Hawala Transfer System</h1>
                        <p class="text-indigo-200 text-sm">Underground Money Transfer Network</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="bg-indigo-700 px-3 py-1 rounded-full text-sm">
                        <i class="fas fa-globe text-xs mr-1"></i><span id="branchCount">47 Active Branches</span>
                    </div>
                    <a href="dashboard.html" class="bg-indigo-700 px-4 py-2 rounded hover:bg-indigo-800">
                        <i class="fas fa-arrow-left"></i> <span data-i18n="dashboard">Dashboard</span>
                    </a>
                    <button class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">
                        <i class="fas fa-sign-out-alt"></i> <span data-i18n="logout">Logout</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-6 py-8">
        
        <!-- Transfer Status Overview -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-green-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">Pending Transfers</p>
                        <h3 class="text-2xl font-bold text-gray-800" id="pendingTransfers">247</h3>
                        <p class="text-green-600 text-sm">↗ 23 new today</p>
                    </div>
                    <div class="bg-green-100 p-3 rounded-full">
                        <i class="fas fa-clock text-green-600 text-2xl"></i>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-blue-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">Today's Volume</p>
                        <h3 class="text-2xl font-bold text-gray-800" id="todayVolume">$847K</h3>
                        <p class="text-blue-600 text-sm">1,234 transfers</p>
                    </div>
                    <div class="bg-blue-100 p-3 rounded-full">
                        <i class="fas fa-dollar-sign text-blue-600 text-2xl"></i>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-purple-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">Active Branches</p>
                        <h3 class="text-2xl font-bold text-gray-800" id="activeBranches">47</h3>
                        <p class="text-purple-600 text-sm">12 countries</p>
                    </div>
                    <div class="bg-purple-100 p-3 rounded-full">
                        <i class="fas fa-building text-purple-600 text-2xl"></i>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-orange-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">Success Rate</p>
                        <h3 class="text-2xl font-bold text-gray-800">99.2%</h3>
                        <p class="text-orange-600 text-sm">Last 30 days</p>
                    </div>
                    <div class="bg-orange-100 p-3 rounded-full">
                        <i class="fas fa-check-circle text-orange-600 text-2xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Transfer Interface -->
        <div class="grid grid-cols-1 xl:grid-cols-3 gap-8 mb-8">
            <!-- New Hawala Transfer -->
            <div class="xl:col-span-2 bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold mb-6">🌍 <span data-i18n="newTransaction">New Hawala Transfer</span></h2>
                
                <form id="hawalaTransferForm" class="space-y-6">
                    <!-- Transfer Type -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">Transfer Type</label>
                        <div class="grid grid-cols-2 gap-4">
                            <label class="cursor-pointer">
                                <input type="radio" name="transferType" value="send" class="sr-only" checked>
                                <div id="sendOption" class="border-2 border-green-200 bg-green-50 rounded-lg p-4 text-center hover:border-green-500 transition-colors">
                                    <i class="fas fa-paper-plane text-2xl text-green-600 mb-2"></i>
                                    <div class="font-semibold text-green-800" data-i18n="sendMoney">Send Money</div>
                                    <div class="text-sm text-green-600">Initiate transfer to another branch</div>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="transferType" value="receive" class="sr-only">
                                <div id="receiveOption" class="border-2 border-blue-200 rounded-lg p-4 text-center hover:border-blue-500 transition-colors">
                                    <i class="fas fa-hand-holding-usd text-2xl text-blue-600 mb-2"></i>
                                    <div class="font-semibold text-blue-800" data-i18n="receiveMoney">Receive Money</div>
                                    <div class="text-sm text-blue-600">Process incoming transfer</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Sender Information -->
                    <div class="border rounded-lg p-4">
                        <h4 class="font-semibold text-gray-800 mb-4">📤 <span data-i18n="senderInfo">Sender Information</span></h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="customerName">Full Name</label>
                                <input type="text" placeholder="Sender's full name" class="w-full p-3 border rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="phoneNumber">Phone Number</label>
                                <input type="tel" placeholder="+971 50 123 4567" class="w-full p-3 border rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="idNumber">ID Number</label>
                                <input type="text" placeholder="Emirates ID / Passport" class="w-full p-3 border rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Nationality</label>
                                <select class="w-full p-3 border rounded-lg">
                                    <option value="">Select Nationality</option>
                                    <option value="AE">🇦🇪 UAE</option>
                                    <option value="SA">🇸🇦 Saudi Arabia</option>
                                    <option value="IR">🇮🇷 Iran</option>
                                    <option value="IN">🇮🇳 India</option>
                                    <option value="PK">🇵🇰 Pakistan</option>
                                    <option value="BD">🇧🇩 Bangladesh</option>
                                    <option value="PH">🇵🇭 Philippines</option>
                                    <option value="EG">🇪🇬 Egypt</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Receiver Information -->
                    <div class="border rounded-lg p-4">
                        <h4 class="font-semibold text-gray-800 mb-4">📥 <span data-i18n="receiverInfo">Receiver Information</span></h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="customerName">Full Name</label>
                                <input type="text" placeholder="Receiver's full name" class="w-full p-3 border rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="phoneNumber">Phone Number</label>
                                <input type="tel" placeholder="+98 912 123 4567" class="w-full p-3 border rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Destination Branch</label>
                                <select id="destinationBranch" class="w-full p-3 border rounded-lg">
                                    <option value="">Select Destination</option>
                                    <option value="tehran_1">🇮🇷 Tehran Branch #1</option>
                                    <option value="tehran_2">🇮🇷 Tehran Branch #2</option>
                                    <option value="isfahan">🇮🇷 Isfahan Branch</option>
                                    <option value="riyadh">🇸🇦 Riyadh Branch</option>
                                    <option value="jeddah">🇸🇦 Jeddah Branch</option>
                                    <option value="mumbai">🇮🇳 Mumbai Branch</option>
                                    <option value="karachi">🇵🇰 Karachi Branch</option>
                                    <option value="dhaka">🇧🇩 Dhaka Branch</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="address">Address</label>
                                <input type="text" placeholder="Full address for pickup" class="w-full p-3 border rounded-lg">
                            </div>
                        </div>
                    </div>

                    <!-- Transfer Details -->
                    <div class="border rounded-lg p-4">
                        <h4 class="font-semibold text-gray-800 mb-4">💰 Transfer Details</h4>
                        
                        <!-- Currency Exchange -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="fromCurrency">Send Currency</label>
                                <select id="sendCurrency" onchange="updateExchangeRate()" class="w-full p-3 border rounded-lg">
                                    <option value="AED">AED - UAE Dirham</option>
                                    <option value="USD">USD - US Dollar</option>
                                    <option value="SAR">SAR - Saudi Riyal</option>
                                    <option value="EUR">EUR - Euro</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="toCurrency">Receive Currency</label>
                                <select id="receiveCurrency" onchange="updateExchangeRate()" class="w-full p-3 border rounded-lg">
                                    <option value="IRT">IRT - Iranian Toman</option>
                                    <option value="INR">INR - Indian Rupee</option>
                                    <option value="PKR">PKR - Pakistani Rupee</option>
                                    <option value="BDT">BDT - Bangladeshi Taka</option>
                                    <option value="USD">USD - US Dollar</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="exchangeRate">Exchange Rate</label>
                                <input type="number" id="exchangeRate" step="0.0001" placeholder="11245.5000" 
                                       class="w-full p-3 border rounded-lg bg-yellow-50" onchange="calculateTotal()">
                            </div>
                        </div>

                        <!-- Amount Calculation -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="amount">Send Amount</label>
                                <input type="number" id="sendAmount" step="0.01" placeholder="1000.00" 
                                       class="w-full p-3 border rounded-lg" onchange="calculateTotal()">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="fees">Transfer Fee</label>
                                <input type="number" id="transferFee" step="0.01" placeholder="25.00" 
                                       class="w-full p-3 border rounded-lg" onchange="calculateTotal()">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Receive Amount</label>
                                <input type="number" id="receiveAmount" placeholder="11,245,000" 
                                       class="w-full p-3 border rounded-lg bg-green-50" readonly>
                            </div>
                        </div>
                    </div>

                    <!-- Transfer Options -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
                            <select class="w-full p-3 border rounded-lg">
                                <option value="normal">Normal (2-4 hours)</option>
                                <option value="urgent">Urgent (30 minutes) +$5</option>
                                <option value="express">Express (15 minutes) +$10</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Notification Method</label>
                            <select class="w-full p-3 border rounded-lg">
                                <option value="sms">SMS Only</option>
                                <option value="call">Phone Call</option>
                                <option value="both">SMS + Phone Call</option>
                                <option value="whatsapp">WhatsApp</option>
                            </select>
                        </div>
                    </div>

                    <!-- Transfer Purpose -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Purpose of Transfer</label>
                        <select class="w-full p-3 border rounded-lg">
                            <option value="family">Family Support</option>
                            <option value="business">Business Payment</option>
                            <option value="education">Education Expenses</option>
                            <option value="medical">Medical Treatment</option>
                            <option value="investment">Investment</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <!-- Special Instructions -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Special Instructions</label>
                        <textarea rows="3" placeholder="Any special requirements or instructions for the receiving branch..." 
                                  class="w-full p-3 border rounded-lg"></textarea>
                    </div>

                    <!-- Submit Button -->
                    <div class="flex space-x-4">
                        <button type="submit" class="flex-1 bg-gradient-to-r from-green-600 to-blue-600 text-white py-3 rounded-lg hover:from-green-700 hover:to-blue-700 font-semibold">
                            <i class="fas fa-paper-plane mr-2"></i><span data-i18n="submit">Process Transfer</span>
                        </button>
                        <button type="button" onclick="generateSecretCode()" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700">
                            <i class="fas fa-key mr-2"></i>Generate Code
                        </button>
                    </div>
                </form>
            </div>

            <!-- Branch Communication Panel -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-lg font-bold mb-6">📡 <span data-i18n="branchNotification">Branch Communication</span></h3>
                
                <!-- Secret Code Generator -->
                <div class="bg-gradient-to-r from-purple-100 to-blue-100 rounded-lg p-4 mb-6">
                    <h4 class="font-semibold text-gray-800 mb-3">🔐 Secret Transfer Code</h4>
                    <div class="text-center">
                        <div id="secretCode" class="text-3xl font-mono font-bold text-purple-600 bg-white rounded-lg p-4 mb-3 tracking-wider">
                            --- --- ---
                        </div>
                        <button onclick="generateSecretCode()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 text-sm">
                            <i class="fas fa-refresh mr-2"></i>Generate New Code
                        </button>
                    </div>
                </div>

                <!-- Branch Status -->
                <div class="mb-6">
                    <h4 class="font-semibold text-gray-800 mb-3">🏢 Destination Branch Status</h4>
                    <div id="branchStatus" class="space-y-3">
                        <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                <span class="text-sm font-medium">Tehran Branch #1</span>
                            </div>
                            <span class="text-xs text-green-600">Online</span>
                        </div>
                        <div class="text-sm text-gray-600">
                            <div class="flex justify-between">
                                <span>Response Time:</span>
                                <span class="font-semibold">1.2 min</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Working Hours:</span>
                                <span class="font-semibold">8:00-22:00</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Available Cash:</span>
                                <span class="font-semibold text-green-600">Available</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Live Chat with Branch -->
                <div class="border rounded-lg">
                    <div class="bg-gray-50 px-4 py-2 rounded-t-lg">
                        <h4 class="font-semibold text-sm">💬 Live Chat</h4>
                    </div>
                    <div id="chatMessages" class="h-48 overflow-y-auto p-4 space-y-3">
                        <div class="bg-blue-100 rounded-lg p-3 max-w-xs">
                            <div class="text-xs text-gray-600 mb-1">Tehran Branch - 2:34 PM</div>
                            <div class="text-sm">Ready to receive transfer TRF-8547</div>
                        </div>
                        <div class="bg-gray-100 rounded-lg p-3 max-w-xs ml-auto">
                            <div class="text-xs text-gray-600 mb-1">You - 2:35 PM</div>
                            <div class="text-sm">Customer arriving in 30 minutes</div>
                        </div>
                    </div>
                    <div class="border-t p-4">
                        <div class="flex space-x-2">
                            <input type="text" placeholder="Type message..." class="flex-1 p-2 border rounded-lg text-sm">
                            <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="mt-6 space-y-3">
                    <button onclick="notifyBranch()" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 text-sm">
                        <i class="fas fa-bell mr-2"></i><span data-i18n="notifyBranch">Notify Branch</span>
                    </button>
                    <button onclick="callBranch()" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 text-sm">
                        <i class="fas fa-phone mr-2"></i>Call Branch
                    </button>
                    <button onclick="sendSMS()" class="w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 text-sm">
                        <i class="fas fa-sms mr-2"></i>Send SMS Alert
                    </button>
                </div>
            </div>
        </div>

        <!-- Recent Transfers -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold">📋 Recent Hawala Transfers</h2>
                <div class="flex space-x-4">
                    <select class="p-2 border rounded-lg">
                        <option value="all">All Statuses</option>
                        <option value="pending">Pending</option>
                        <option value="processing">Processing</option>
                        <option value="completed">Completed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                    <button onclick="refreshTransfers()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="min-w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Transfer ID</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Sender</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Receiver</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Route</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Amount</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Secret Code</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="transfersTable">
                        <!-- Transfers will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="../js/language.js"></script>
    <script>
        // Mock transfer data
        let transfers = [
            {
                id: "HWL-8547",
                sender: "Ahmad Hassan",
                senderPhone: "+971 50 123 4567",
                receiver: "Mohammad Rezaei",
                receiverPhone: "+98 912 345 6789",
                fromBranch: "Dubai Main",
                toBranch: "Tehran #1",
                sendCurrency: "AED",
                receiveCurrency: "IRT", 
                sendAmount: 1000,
                receiveAmount: 11245000,
                rate: 11245,
                fee: 25,
                status: "pending",
                secretCode: "247-851-963",
                created: "2024-02-16 14:30",
                priority: "normal"
            },
            {
                id: "HWL-8548",
                sender: "Fatima Ali",
                senderPhone: "+971 55 987 6543",
                receiver: "Shahla Karimi",
                receiverPhone: "+98 915 123 4567",
                fromBranch: "Abu Dhabi",
                toBranch: "Isfahan",
                sendCurrency: "AED",
                receiveCurrency: "IRT",
                sendAmount: 2500,
                receiveAmount: 28125000,
                rate: 11250,
                fee: 50,
                status: "processing",
                secretCode: "159-753-486",
                created: "2024-02-16 13:15",
                priority: "urgent"
            },
            {
                id: "HWL-8549",
                sender: "Rajesh Kumar",
                senderPhone: "+971 52 456 7890",
                receiver: "Priya Sharma",
                receiverPhone: "+91 98765 43210",
                fromBranch: "Dubai Main",
                toBranch: "Mumbai",
                sendCurrency: "AED",
                receiveCurrency: "INR",
                sendAmount: 1500,
                receiveAmount: 33975,
                rate: 22.65,
                fee: 30,
                status: "completed",
                secretCode: "753-951-624",
                created: "2024-02-16 12:00",
                priority: "express"
            }
        ];

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            populateTransfersTable();
            setupFormHandlers();
            updateExchangeRate();
        });

        function populateTransfersTable() {
            const tbody = document.getElementById('transfersTable');
            if (!tbody) return;

            tbody.innerHTML = transfers.map(transfer => {
                const statusColors = {
                    'pending': 'bg-yellow-100 text-yellow-800',
                    'processing': 'bg-blue-100 text-blue-800',
                    'completed': 'bg-green-100 text-green-800',
                    'cancelled': 'bg-red-100 text-red-800'
                };

                const priorityIcons = {
                    'normal': '',
                    'urgent': '<i class="fas fa-bolt text-orange-500 ml-1"></i>',
                    'express': '<i class="fas fa-rocket text-red-500 ml-1"></i>'
                };

                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4">
                            <div class="font-medium">${transfer.id}</div>
                            <div class="text-sm text-gray-500">${transfer.created}${priorityIcons[transfer.priority]}</div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="font-medium">${transfer.sender}</div>
                            <div class="text-sm text-gray-500">${transfer.senderPhone}</div>
                            <div class="text-xs text-gray-400">${transfer.fromBranch}</div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="font-medium">${transfer.receiver}</div>
                            <div class="text-sm text-gray-500">${transfer.receiverPhone}</div>
                            <div class="text-xs text-gray-400">${transfer.toBranch}</div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="text-sm">
                                <div class="flex items-center space-x-1">
                                    <span class="font-medium">${transfer.fromBranch}</span>
                                    <i class="fas fa-arrow-right text-gray-400"></i>
                                    <span class="font-medium">${transfer.toBranch}</span>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="font-medium">${formatCurrency(transfer.sendAmount, transfer.sendCurrency)}</div>
                            <div class="text-sm text-gray-500">→ ${formatCurrency(transfer.receiveAmount, transfer.receiveCurrency)}</div>
                            <div class="text-xs text-gray-400">Rate: ${transfer.rate.toLocaleString()}</div>
                        </td>
                        <td class="px-6 py-4">
                            <span class="px-2 py-1 text-xs rounded-full ${statusColors[transfer.status]}">
                                ${transfer.status.charAt(0).toUpperCase() + transfer.status.slice(1)}
                            </span>
                        </td>
                        <td class="px-6 py-4">
                            <div class="font-mono text-sm font-bold">${transfer.secretCode}</div>
                            <button onclick="copySecretCode('${transfer.secretCode}')" class="text-xs text-blue-600 hover:text-blue-800">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex space-x-2">
                                <button onclick="viewTransfer('${transfer.id}')" class="text-blue-600 hover:text-blue-800">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button onclick="notifyBranchForTransfer('${transfer.id}')" class="text-green-600 hover:text-green-800">
                                    <i class="fas fa-bell"></i>
                                </button>
                                <button onclick="callBranchForTransfer('${transfer.id}')" class="text-purple-600 hover:text-purple-800">
                                    <i class="fas fa-phone"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function setupFormHandlers() {
            // Radio button handlers
            document.querySelectorAll('input[name="transferType"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    document.getElementById('sendOption').className = this.value === 'send' 
                        ? 'border-2 border-green-200 bg-green-50 rounded-lg p-4 text-center transition-colors'
                        : 'border-2 border-gray-200 rounded-lg p-4 text-center hover:border-green-500 transition-colors';
                    
                    document.getElementById('receiveOption').className = this.value === 'receive'
                        ? 'border-2 border-blue-200 bg-blue-50 rounded-lg p-4 text-center transition-colors'
                        : 'border-2 border-gray-200 rounded-lg p-4 text-center hover:border-blue-500 transition-colors';
                });
            });

            // Form submission
            document.getElementById('hawalaTransferForm').addEventListener('submit', function(e) {
                e.preventDefault();
                processHawalaTransfer();
            });
        }

        // Exchange rate management
        const exchangeRates = {
            'AED_IRT': 11245.5000,
            'AED_INR': 22.6500,
            'AED_PKR': 75.8400,
            'AED_BDT': 29.2100,
            'USD_IRT': 41285.0000,
            'USD_INR': 83.1500,
            'USD_PKR': 278.5000,
            'USD_BDT': 107.2000,
            'SAR_AED': 0.9793,
            'SAR_IRT': 11015.2000,
            'EUR_USD': 1.0856
        };

        function updateExchangeRate() {
            const sendCurrency = document.getElementById('sendCurrency')?.value;
            const receiveCurrency = document.getElementById('receiveCurrency')?.value;
            const rateField = document.getElementById('exchangeRate');
            
            if (!sendCurrency || !receiveCurrency || !rateField) return;
            
            const rateKey = `${sendCurrency}_${receiveCurrency}`;
            const rate = exchangeRates[rateKey];
            
            if (rate) {
                rateField.value = rate.toFixed(4);
                rateField.style.backgroundColor = '#f0f9ff'; // Light blue
            } else {
                rateField.value = '';
                rateField.style.backgroundColor = '#fef3c7'; // Light yellow
            }
            
            calculateTotal();
        }

        function calculateTotal() {
            const sendAmount = parseFloat(document.getElementById('sendAmount')?.value) || 0;
            const exchangeRate = parseFloat(document.getElementById('exchangeRate')?.value) || 0;
            const fee = parseFloat(document.getElementById('transferFee')?.value) || 0;
            const receiveAmountField = document.getElementById('receiveAmount');
            
            if (!receiveAmountField) return;
            
            if (sendAmount > 0 && exchangeRate > 0) {
                const netAmount = sendAmount - fee;
                const receiveAmount = netAmount * exchangeRate;
                receiveAmountField.value = formatNumber(receiveAmount.toFixed(0));
            } else {
                receiveAmountField.value = '';
            }
        }

        function generateSecretCode() {
            const code = Array.from({length: 3}, () => 
                Math.floor(Math.random() * 900 + 100)
            ).join('-');
            
            document.getElementById('secretCode').textContent = code;
            showNotification('New secret code generated: ' + code, 'success');
        }

        function processHawalaTransfer() {
            // Simulate processing
            showNotification('Processing hawala transfer...', 'info');
            
            setTimeout(() => {
                const transferId = 'HWL-' + Math.floor(Math.random() * 9000 + 1000);
                showNotification(`Transfer ${transferId} created successfully!`, 'success');
                
                // Generate secret code if not already generated
                if (document.getElementById('secretCode').textContent === '--- --- ---') {
                    generateSecretCode();
                }
                
                // Add to transfers table
                const newTransfer = {
                    id: transferId,
                    sender: document.querySelector('input[placeholder="Sender\'s full name"]').value || 'New Customer',
                    receiver: document.querySelector('input[placeholder="Receiver\'s full name"]').value || 'Receiver',
                    fromBranch: 'Current Branch',
                    toBranch: document.getElementById('destinationBranch').options[document.getElementById('destinationBranch').selectedIndex].text,
                    sendCurrency: document.getElementById('sendCurrency').value,
                    receiveCurrency: document.getElementById('receiveCurrency').value,
                    sendAmount: parseFloat(document.getElementById('sendAmount').value) || 0,
                    receiveAmount: parseFloat(document.getElementById('receiveAmount').value.replace(/,/g, '')) || 0,
                    rate: parseFloat(document.getElementById('exchangeRate').value) || 0,
                    status: 'pending',
                    secretCode: document.getElementById('secretCode').textContent,
                    created: new Date().toISOString().slice(0, 16).replace('T', ' '),
                    priority: 'normal'
                };
                
                transfers.unshift(newTransfer);
                populateTransfersTable();
                
                // Notify branch
                notifyBranch();
            }, 2000);
        }

        function notifyBranch() {
            showNotification('Branch notification sent successfully', 'success');
            
            // Simulate adding a chat message
            const chatMessages = document.getElementById('chatMessages');
            if (chatMessages) {
                const newMessage = document.createElement('div');
                newMessage.className = 'bg-gray-100 rounded-lg p-3 max-w-xs ml-auto';
                newMessage.innerHTML = `
                    <div class="text-xs text-gray-600 mb-1">You - ${new Date().toLocaleTimeString()}</div>
                    <div class="text-sm">New transfer ready for processing</div>
                `;
                chatMessages.appendChild(newMessage);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }

        function callBranch() {
            showNotification('Initiating call to destination branch...', 'info');
        }

        function sendSMS() {
            showNotification('SMS alert sent to branch manager', 'success');
        }

        function copySecretCode(code) {
            navigator.clipboard.writeText(code).then(() => {
                showNotification('Secret code copied to clipboard', 'success');
            });
        }

        function viewTransfer(id) {
            showNotification('Opening transfer details for ' + id, 'info');
        }

        function notifyBranchForTransfer(id) {
            showNotification('Notification sent for transfer ' + id, 'success');
        }

        function callBranchForTransfer(id) {
            showNotification('Calling branch for transfer ' + id, 'info');
        }

        function refreshTransfers() {
            showNotification('Refreshing transfer list...', 'info');
            setTimeout(() => {
                populateTransfersTable();
                showNotification('Transfer list updated', 'success');
            }, 1000);
        }
    </script>
</body>
</html>
